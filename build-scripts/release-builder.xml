<?xml version="1.0" encoding="UTF-8"?>
<!--
/*******************************************************************************
 * Copyright (c) 2010 Matthew J. Dovey (www.ceridwen.com).
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the GNU Public License v3.0
 * which accompanies this distribution, and is available at 
 * <http://www.gnu.org/licenses/>
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>. 
 -->

<!-- Build script module for recording the release into subversion -->

<project>
	<property environment="env" />
  	<import file="version-builder.xml"/>
	
	<target name="check-jira-release">
		<condition property="jira.release">
	   		<isset property="${env.bamboo_jira_version}"/>
		</condition>
	</target>

  	<target name="record-release" depends="stamp-build, check-jira-release">
  		<fail message="Version mismatch: Jira reports ${env.bamboo_jira_version} whilst build-data.properties reports ${implementation-short-version}">
  			<not>
		  		<condition>
		  		    <equals arg1="${env.bamboo_jira_version}" arg2="${implementation-short-version}"/>
		  		</condition>
  			</not>
  		</fail>
  		
  		<echo message="Stamp as ${env.bamboo_jira_version}" />
  	</target>
</project>